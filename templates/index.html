<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moteur de recherche</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

    <SCRIPT LANGUAGE="JavaScript">
        let progressBar;
        let width = 0;
        let interval;

        function afficher()
        {
        alert("Vous venez de cliquer sur le bouton!")
        }

        function notImage()
        {
            alert("Ce fichier n'est pas une image")
        }

        function allowDrop(event) {
          event.preventDefault();
          event.currentTarget.classList.add('dragover');
        }
    
        function drag(event) {
            event.dataTransfer.setData("text", event.target.id);
        }
    
        function drop(event) {
            event.preventDefault();
            //afficher();
            var files = event.dataTransfer.files;
            var inImageDisplay = document.getElementById('input_image_display');

            if (files.length > 0) {
                var file = files[0];
                if (file.type.startsWith('image/')) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        inImageDisplay.innerHTML = '<img src="' + e.target.result + '" alt="Uploaded Image" />';
                    }
                    reader.readAsDataURL(file);
                } else {
                    notImage();
                }
            }
        }

        function selectInput() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            const imagePreviewContainer = document.getElementById('input_image_display');
            
            if(file.type.match('image.*')){
                const reader = new FileReader();
                
                reader.addEventListener('load', function (event) {
                const imageUrl = event.target.result;
                const image = new Image();
                
                image.addEventListener('load', function() {
                    imagePreviewContainer.innerHTML = ''; // Vider le conteneur au cas où il y aurait déjà des images.
                    imagePreviewContainer.appendChild(image);
                });
                
                image.src = imageUrl;
                image.style.width = '200px'; // Indiquez les dimensions souhaitées ici.
                image.style.height = 'auto'; // Vous pouvez également utiliser "px" si vous voulez spécifier une hauteur.
                });
                
                reader.readAsDataURL(file);
            }
            else{
                notImage();
            }
        }

        function updateProgressBar() {
            if (width >= 100) {
                clearInterval(interval);
            } else {
                width++;
                progressBar.style.width = width + '%';
                progressBar.textContent = width + '%';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            progressBar = document.getElementById('progress-bar');
            interval = setInterval(updateProgressBar, 100);
        });
    </SCRIPT>

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Moteur de recherche</h1>
        </div>

        <div class="menu">
            <select name="descriptor_type">
                <option value="default" selected>Type de descripteur</option>
                <option value="color">Color</option>
                <option value="shape">Shape</option>
            </select>
            <select name="similarity_calculation">
                <option value="default" selected>Calcul similarité</option>
                <option value="euclidean">Euclidean</option>
                <option value="manhattan">Manhattan</option>
            </select>
            <select name="images_to_display">
                <option value="default" selected>Nombre images à afficher</option>
                <option value="10">10</option>
                <option value="20">20</option>
            </select>
            <button type="submit" formaction="/search">Rechercher</button>
        </div>

        <div class="image-upload" ondrop="drop(event)" ondragover="allowDrop(event)">
            <div>
                <div id="input_image_display"></div>
                <form action="/upload" method="post" enctype="multipart/form-data">
                    <input type="file" id="fileInput" onchange="selectInput()" style="display:none">
                    <button id="selectImgBtn" type="button" onclick="document.getElementById('fileInput').click()">Drop image here or click to select</button>
                </form>
            </div>
            
        </div>
        
        <div class="scroller">
            <div class="results">
                <img src="{{ url_for('static', filename='polytech.jpg') }}" alt="Default Image 1">
                <img src="{{ url_for('static', filename='bibli.jpg') }}" alt="Default Image 2">
                <img src="{{ url_for('static', filename='320.jpg') }}" alt="Default Image 3">
                <img src="{{ url_for('static', filename='415.jpg') }}" alt="Default Image 4">
                <img src="{{ url_for('static', filename='624.jpg') }}" alt="Default Image 5">
                <img src="{{ url_for('static', filename='736.jpg') }}" alt="Default Image 6">
                <img src="{{ url_for('static', filename='986.jpg') }}" alt="Default Image 7">
                <img src="{{ url_for('static', filename='polytech.jpg') }}" alt="Default Image 8">
                <img src="{{ url_for('static', filename='bibli.jpg') }}" alt="Default Image 9">
                <img src="{{ url_for('static', filename='320.jpg') }}" alt="Default Image 10">
            </div>
        </div>
    </div>

    <br>
    <div class="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
    </div>
    <br>
    

    <footer>Ce site a été développé dans le cadre d'un cours à la faculté polytechnique de l'UMONS pour déployer un service SaaS de moteur de recherche 
        <br><a href="/nosInfos">En savoir plus</a>
    </footer>
</body>
</html>